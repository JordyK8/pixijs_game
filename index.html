<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body{
            margin: 0
        }
        canvas {
            display: block;
            background: blue;
        }
    </style>
</head>
<body>
    <script src="pixi.js"></script>
    <script>
        let playerSheet = {};
        let keys = {}
        let player;
        let speed = 3
        let lastAction;
        const app = new PIXI.Application({
            width: window.innerWidth,
            height: window.innerHeight,
        });
        document.body.appendChild(app.view)

        const texture = PIXI.Texture.from('cloudd.gif')
        
        app.loader.add("sara", "characters/sara.png")
        app.loader.add("sara2", "characters/sara2.png")
        app.loader.load(doneLoading)

        // const player = new PIXI.Sprite(texture);
        // player.x = app.renderer.width / 2;
        // player.y = app.renderer.height / 2;
        // player.anchor.x = 0.5
        // player.anchor.y = 0.5
        // app.stage.addChild(player)
        
        
        window.addEventListener("keydown", keysDown)
        window.addEventListener("keyup", keysUp)
        
        function doneLoading(e) {
            createPlayerSheet()
            createPlayer()
            app.ticker.add(gameloop);
        }

        function createPlayerSheet() {
            let ssheet = new PIXI.BaseTexture(app.loader.resources["sara"].url)
            let ssheet2 = new PIXI.BaseTexture(app.loader.resources["sara2"].url)
            let w = 96,
                h = 180,
                m = 25;

            playerSheet["standSouth"] = [new PIXI.Texture(ssheet, new PIXI.Rectangle(2 * w, 0, w, h))]
            playerSheet["standNorth"] = [new PIXI.Texture(ssheet, new PIXI.Rectangle(8 * w, 0, w, h))]
            playerSheet["standEast"] = [new PIXI.Texture(ssheet2, new PIXI.Rectangle(4 * w + m, 0, w, h))]
            playerSheet["standWest"] = [new PIXI.Texture(ssheet, new PIXI.Rectangle(14 * w + 5, 0, w + 5, h))]
        
            playerSheet["walkSouth"] = [
                new PIXI.Texture(ssheet, new PIXI.Rectangle(0 * w, 0, w, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(2 * w, 0, w, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(4 * w, 0, w, h)),
            ]

            playerSheet["walkNorth"] = [
                new PIXI.Texture(ssheet, new PIXI.Rectangle(6 * w, 0, w, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(8 * w, 0, w, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(10 * w, 0, w, h)),
            ]

            playerSheet["walkEast"] = [
                new PIXI.Texture(ssheet2, new PIXI.Rectangle(2 * w + m, 0, w, h)),
                new PIXI.Texture(ssheet2, new PIXI.Rectangle(4 * w + m, 0, w, h)),
                new PIXI.Texture(ssheet2, new PIXI.Rectangle(6 * w + m, 0, w, h)),
            ]

            playerSheet["walkWest"] = [
                new PIXI.Texture(ssheet, new PIXI.Rectangle(12 * w + 5, 0, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(14 * w + 5, 0, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(16 * w + 5, 0, w + 5, h)),
            ]

            playerSheet["spellCast"] = [
                new PIXI.Texture(ssheet, new PIXI.Rectangle(4 * w, h, w, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(6 * w, h, w, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(8 * w, h, w, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(10 * w, h, w, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(8 * w, h, w, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(6 * w, h, w, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(4 * w, h, w, h)),
            ]
            playerSheet["spellPrepare"] = [
                new PIXI.Texture(ssheet, new PIXI.Rectangle(14 * w + 5, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(12 * w + 5, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(14 * w + 5, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(12 * w + 5, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(14 * w + 5, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(12 * w + 5, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(14 * w + 5, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(12 * w + 5, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(14 * w + 5, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(12 * w + 5, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(14 * w + 5, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(12 * w + 5, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(14 * w + 5, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(4 * w + 5, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(6 * w + 5, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(8 * w + 5, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(10* w - 8, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(10* w - 8, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(10* w - 8, h + 10, w + 5, h)),
                new PIXI.Texture(ssheet, new PIXI.Rectangle(4 * w + 5, h + 10, w + 5, h)),
        ]
            }
            
            function createPlayer(){
            player = new PIXI.AnimatedSprite(playerSheet.standSouth);
            player.anchor.x = 0.5
            player.anchor.y = 0.5
            player.scale.y = 0.3
            player.scale.x = 0.3
            player.animationSpeed = .2
            player.loop = false
            player.x = app.renderer.width / 2;
            player.y = app.renderer.height / 2;
            app.stage.addChild(player)
            player.play()
        }

        function gameloop(){
            //W
            if(keys["87"]) {
                lastAction = 'walkNorth'
                if(!player.playing){
                    player.textures = playerSheet.walkNorth
                    player.play()
                }
                player.y -= speed
            }
            //A
            if(keys["65"]) {
                lastAction = 'walkWest'
                if(!player.playing){
                    player.textures = playerSheet.walkWest
                    player.play()
                }
                player.x -= speed
            }
            //S
            if(keys["83"]) {
                lastAction = 'walkSouth'
                if(!player.playing){
                    player.textures = playerSheet.walkSouth
                    player.play()
                }
                player.y += speed
            }
            //D
            if(keys["68"]) {
                lastAction = 'walkEast'
                if(!player.playing){
                    player.textures = playerSheet.walkEast
                    player.play()
                }
                player.x += speed
            }
            //Spacebar
            if(keys["32"]) {
                
                if(!player.playing){
                    player.textures = playerSheet.spellPrepare
                    player.play()
                }
            }
        }

        function keysUp(e){
            if(e.keyCode === '32') return
            keys[e.keyCode] = false
            player.stop()
            switch (lastAction) {
                case 'walkSouth':
                    player.textures = playerSheet.standSouth
                    break;
                case 'walkNorth':
                    player.textures = playerSheet.standNorth
                    break;
                case 'walkEast':
                    player.textures = playerSheet.standEast
                    break;
                case 'walkWest':
                    player.textures = playerSheet.standWest
                    break;
            
                default:
                    break;
            }

        }
        function keysDown(e){
            keys[e.keyCode] = true
        }
    </script>
</body>
</html>